sudo: false
language: node_js
node_js:
- '10'
- '11'
cache: npm
script:
  - gulp build
jobs:
  include:
    - stage: GitHub Release
      node_js: '11'
      before_deploy:
        # Set up git user name and tag this commit
        - git config --local user.name "Lu√≠s Leite"
        - git config --local user.email "ochii@leite.xyz"
        # write npm version to version.txt file
        - npm run write-version
        # setup vars
        - export GIT_COMMIT_HASH=$(git rev-parse --short=8 HEAD)
        - export GIT_BRANCH=${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}       
        - export SERVER_VERSION=$(cat version.txt)
        - export FILENAME_SUFFIX="$SERVER_VERSION-$GIT_COMMIT_HASH-$GIT_BRANCH"
        - git tag $SERVER_VERSION
        # Pack the transpiled source code
        - tar -zcf cso2-inventory-service_$FILENAME_SUFFIX.tar.gz dist package.json package-lock.json LICENSE README.md
      deploy:
        name: Version $SERVER_VERSION
        provider: releases
        api_key:
          secure: AlCDlikrC7bYgXsEhjeFXkaA5EvXN2MYjI4wAFuWYmCNh96a7VEqT5tOVG41Xq5gjRlKeG05rYxVmjMSYWMgVgcUOEirNpGIqJhcWn5UK6vldalHanU8Vimi7BWxgdUeIHY/BcUmTcDNpGwBwHtZLRAQeasoxZfYFz6iAEsvEbmj+OU4kFqbVDXwNTlt9/UjWlWHxPFs4oV44dxriaKSPyCOgm1w96YCttALkOpOwnEYuavoE8O4NYe077cXt9GUYeWp7JUWj7e8X/hhhgBrntMLZvcZRfHeaKaIJI7AvlK6hDc+UsSGCOw9sAydVnQTJRwGGJupCzl8F1rIa7gPGnOTOOBzqRI3rzZ5EKT2SRJ3c4VOUTujPlxR1WucgkJ1fQsPBiE9hmf5zzwsB3tabu2BWLfqT8eIjJf1+YYkMK69ehbGk4CuSzCljvivWOb/OmUiaAa2sxcK37KWemVKZA4qbZIX/j5KK+7RWizEOV+hlEANl3U87fNcYkM5uUjZJ5GDgqMPaAwGeUOk6mvgIbB8nowFTw1ApxSSpPO/fy4ark9GMdeXs+Zls2d0JNwtkAic3YQFysmCToIEg6i78QPtrzyl0myIoDhlQ6rGXWnkOG2mvrvSSfLz0pFCegbeVyZrnZyZ24jyun0rtPBx+S8jwEoIeQkRisW8juAZOYo=
        file: "cso2-inventory-service_$FILENAME_SUFFIX.tar.gz"
        skip_cleanup: true
        overwrite: true